<!-- snippets/product-stories.liquid -->

{% comment %}
Check that we have articles that match the current product handle
{% endcomment %}

{% assign count = 0 %}
{% for article in blogs.stories.articles %}
  {% for tag in article.tags %}
    {% if tag == product.handle or tag == 'General Story' %}
      {% assign count = count | plus: 1 %}
    {% endif %}
  {% endfor %}
{% endfor %}

{% if count > 0 %}
  <section id="stories" class="container color grey">
    <div class="wrapper">
      <div class="grid--full grid-uniform">
        <div class="grid__item flex__item">
    			<h3 class="text-center">Stories</h3>
    		</div>
        <div class="grid__item flex__item">
          <div class="slick-wrapper">
            <div class="slick_left">{% include 'icon' with 'previous' %}</div>
            <div class="slick_right">{% include 'icon' with 'next' %}</div>
            <div class="slick-stories grid-uniform">
              {% for article in blogs.stories.articles %}
                {% for tag in article.tags %}
                  {% if tag == product.handle or tag == 'General Story' %}
                    {% if article.content contains '[story' %}
                      {% assign article_content = article.content | split: '[story ' %}
                      {% assign article_content = article_content | last %}
                      {%- assign link = article_content | replace: 'link="', '' | replace: '"]', '' -%}
                    {% endif %}
                    <div class="grid__item text-center">
                      <div class="story-wrapper">
                        {% if link != blank %}<a href="{{ link }}" target="_blank" rel="nofollow" title="{{ article.title }}" class="grid__image" style="background-image:url({{ article | img_url: 'large' }});background-size:cover;background-position:center center;"></a>{% endif %}
                        <div class="story-part-text">
                          <div class="story-part-text-inner">
                            <p>
                              {% if link != blank %}<a target="_blank" rel="nofollow" title="{{ article.title }}" href="{{ link }}">{% endif %}
                                {{ article.title }}
                              {% if link != blank %}</a>{% endif %}
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  {% endif %}
                {% endfor %}
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
  <script>
    $(document).ready(function() {
      $('.slick-stories').slick({
      dots: false,
      prevArrow: '#stories .slick_left',
      nextArrow: '#stories .slick_right',
      infinite: true,
      speed: 300,
      slidesToShow: 3,
      slidesToScroll: 3,
      responsive: [
        {
          breakpoint: 1024,
          settings: {
            slidesToShow: 2,
            slidesToScroll: 2,
            infinite: true
          }
        },
        {
          breakpoint: 600,
          settings: {
            slidesToShow: 1,
            slidesToScroll: 1
          }
        }
      ]
      });
    });
  </script>
{% endif %}
