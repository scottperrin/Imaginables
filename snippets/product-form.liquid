<!-- /snippets/product-form.liquid -->
<h1 itemprop="name">{{ product.title }}</h1>
<div itemprop="offers" itemscope itemtype="http://schema.org/Offer">
  <meta itemprop="priceCurrency" content="{{ shop.currency }}">
  <link itemprop="availability" href="http://schema.org/{% if product.available %}InStock{% else %}OutOfStock{% endif %}">
  {% comment %}
    ID addToCartForm is a selector for the ajax cart plugin
  {% endcomment %}
  <form action="/cart/add" method="post" enctype="multipart/form-data" id="AddToCartForm" class="form-vertical">
    <div class="grid__item">
      <div class="select-wrapper large--right">
        <select name="id" id="productSelect" class="product-single__variants">
          {% for variant in product.variants %}

            {% if variant.available %}
              <option {% if variant == product.selected_or_first_available_variant %} selected="selected" {% endif %} data-sku="{{ variant.sku }}" value="{{ variant.id }}">{{ variant.title }} - {{ variant.price | money_with_currency }}</option>
            {% else %}
              <option disabled="disabled">
                {{ variant.title }} - {{ 'products.product.sold_out' | t }}
              </option>
            {% endif %}

          {% endfor %}
        </select>
      </div>
    </div>
    <span class="visually-hidden">{{ 'products.general.regular_price' | t }}</span>
    <span id="ProductPrice" class="h6" itemprop="price" content="{{ current_variant.price | divided_by: 100 }}">
      {{ current_variant.price | money }}
    </span>
    {% if product.compare_at_price_max > product.price %}
      <span class="visually-hidden">{{ 'products.general.sale_price' | t }}</span>
      <p id="ComparePrice" class="sale">
        {{ 'products.product.compare_at' | t }} {{ current_variant.compare_at_price | money }}
      </p>
    {% endif %}
    <div class="grid">
      <div class="grid__item one-whole large--one-quarter large--text-right push--large--two-quarters center">
        <label for="Quantity" class="quantity-selector">{{ 'products.product.quantity' | t }}</label>
        <div class="qty_wrapper large--right">
          <input type="number" id="Quantity" name="quantity" value="1" min="1" class="quantity-selector">
        </div>
      </div>
      <div class="grid__item one-whole large--one-quarter large--text-right push--large--two-quarters center">
        <button type="submit" name="add" id="AddToCart" class="btn large--right">
          <span id="AddToCartText">{{ 'products.product.add_to_cart' | t }}</span>
        </button>
      </div>
    </div>
  </form>
</div>


{{ 'option_selection.js' | shopify_asset_url | script_tag }}
<script>
  var selectCallback = function(variant, selector) {
    // Price
    timber.productPage({
      money_format: "{{ shop.money_format }}",
      variant: variant,
      selector: selector
    });
    // Stock Levels
    if (variant) {
      if (variant.inventory_management == "shopify" && variant.inventory_policy != "continue") {
        if (variant.inventory_quantity > 0) {
          $('#variantInventory').text(variant.inventory_quantity + ' In Stock');
        } else {
          $('#variantInventory').text("Currently Unavailable");
        }
      } else {
        $('#variantInventory').text("This product is available");
      }
    } else {
      $('#variantInventory').text("");
    }
    // SKU
    if (variant) {
      $('#variantSku').text(variant.sku);
    } else {
      $('#variantSku').hide();
    }
  };
  // Option Selectors
  jQuery(function($) {
    new Shopify.OptionSelectors('productSelect', {
      product: {{ product | json }},
      onVariantSelected: selectCallback,
      enableHistoryState: true
    });
    // Add label if only one product option and it isn't 'Title'. Could be 'Size'.
    {% if product.options.size == 1 and product.options.first != 'Title' %}
      $('.selector-wrapper:eq(0)').prepend('<label for="productSelect-option-0">{{ product.options.first | escape }}</label>');
    {% endif %}
    // Hide selectors if we only have 1 variant and its title contains 'Default'.
    {% if product.variants.size == 1 and product.variants.first.title contains 'Default' %}
      $('.selector-wrapper').hide();
    {% endif %}
  });
</script>
